<div class="dashboard-container">
  <!-- Loading State -->
  @if (isLoading()) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>טוען נתונים...</p>
    </div>
  } @else {
    <!-- Welcome Section -->
    <div class="welcome-section">
      <h1>
        <mat-icon>dashboard</mat-icon>
        {{ getGreeting() }}, {{ currentUser()?.name || 'משתמש' }}! 
      </h1>
      <p>ברוך הבא למערכת ניהול המשימות שלך</p>
    </div>

    <!-- Statistics Grid -->
    <div class="stats-grid">
      <mat-card class="stat-card tasks-card">
        <mat-card-content>
          <div class="stat-header">
            <mat-icon>task_alt</mat-icon>
            <span class="stat-label">סה"כ משימות</span>
          </div>
          <div class="stat-value">{{ totalTasks() }}</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card completed-card">
        <mat-card-content>
          <div class="stat-header">
            <mat-icon>check_circle</mat-icon>
            <span class="stat-label">הושלמו</span>
          </div>
          <div class="stat-value">{{ completedTasks() }}</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card progress-card">
        <mat-card-content>
          <div class="stat-header">
            <mat-icon>pending</mat-icon>
            <span class="stat-label">בביצוע</span>
          </div>
          <div class="stat-value">{{ inProgressTasks() }}</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card pending-card">
        <mat-card-content>
          <div class="stat-header">
            <mat-icon>radio_button_unchecked</mat-icon>
            <span class="stat-label">לביצוע</span>
          </div>
          <div class="stat-value">{{ todoTasks() }}</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card projects-card">
        <mat-card-content>
          <div class="stat-header">
            <mat-icon>folder</mat-icon>
            <span class="stat-label">פרויקטים</span>
          </div>
          <div class="stat-value">{{ totalProjects() }}</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card teams-card">
        <mat-card-content>
          <div class="stat-header">
            <mat-icon>group</mat-icon>
            <span class="stat-label">צוותים</span>
          </div>
          <div class="stat-value">{{ totalTeams() }}</div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Recent Activity -->
    <div class="content-grid">
      <!-- Recent Tasks -->
      <mat-card class="activity-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>task</mat-icon>
          <mat-card-title>משימות אחרונות</mat-card-title>
          <mat-card-subtitle>{{ recentTasks().length }} משימות מתוך {{ totalTasks() }}</mat-card-subtitle>
        </mat-card-header>
        
        <mat-card-content>
          @if (recentTasks().length > 0) {
            <mat-list>
              @for (task of recentTasks(); track task.id) {
                <mat-list-item>
                  <mat-icon matListItemIcon [class]="'status-icon-' + task.status">
                    {{ task.status === 'completed' ? 'check_circle' : task.status === 'in_progress' ? 'pending' : 'radio_button_unchecked' }}
                  </mat-icon>
                  <div matListItemTitle>{{ task.title }}</div>
                  <div matListItemLine>
                    <mat-chip-set>
                      <mat-chip [class]="'status-' + task.status">
                        {{ task.status === 'todo' ? 'לביצוע' : task.status === 'in_progress' ? 'בביצוע' : 'הושלם' }}
                      </mat-chip>
                    </mat-chip-set>
                  </div>
                </mat-list-item>
                <mat-divider></mat-divider>
              }
            </mat-list>
          } @else {
            <p class="empty-message">אין משימות אחרונות</p>
          }
        </mat-card-content>
        
        <mat-card-actions>
          <a mat-button [routerLink]="['/tasks']" color="primary">
            <mat-icon>arrow_forward</mat-icon>
            כל המשימות
          </a>
        </mat-card-actions>
      </mat-card>

      <!-- Recent Projects -->
      <mat-card class="activity-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>folder_open</mat-icon>
          <mat-card-title>פרויקטים אחרונים</mat-card-title>
          <mat-card-subtitle>{{ recentProjects().length }} פרויקטים מתוך {{ totalProjects() }}</mat-card-subtitle>
        </mat-card-header>
        
        <mat-card-content>
          @if (recentProjects().length > 0) {
            <mat-list>
              @for (project of recentProjects(); track project.id) {
                <mat-list-item>
                  <mat-icon matListItemIcon>folder</mat-icon>
                  <div matListItemTitle>{{ project.name }}</div>
                  <div matListItemLine>{{ project.description }}</div>
                </mat-list-item>
                <mat-divider></mat-divider>
              }
            </mat-list>
          } @else {
            <p class="empty-message">אין פרויקטים אחרונים</p>
          }
        </mat-card-content>
        
        <mat-card-actions>
          <a mat-button [routerLink]="['/projects']" color="primary">
            <mat-icon>arrow_forward</mat-icon>
            כל הפרויקטים
          </a>
        </mat-card-actions>
      </mat-card>
    </div>

    <!-- Quick Actions -->
    <mat-card class="quick-actions-card">
      <mat-card-header>
        <mat-icon mat-card-avatar>flash_on</mat-icon>
        <mat-card-title>פעולות מהירות</mat-card-title>
      </mat-card-header>
      
      <mat-card-content>
        <div class="quick-actions">
          <button mat-raised-button color="primary" [routerLink]="['/tasks']">
            <mat-icon>add_task</mat-icon>
            משימה חדשה
          </button>
          <button mat-raised-button color="accent" [routerLink]="['/projects']">
            <mat-icon>create_new_folder</mat-icon>
            פרויקט חדש
          </button>
          <button mat-raised-button [routerLink]="['/teams']">
            <mat-icon>group_add</mat-icon>
            צוות חדש
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  }
</div>